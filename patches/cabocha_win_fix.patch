diff --git a/src/common.h b/src/common.h
index 197ea68..939ed0d 100644
--- a/src/common.h
+++ b/src/common.h
@@ -131,7 +131,9 @@ class wlog {
 #include <hash_map>
 #include <hash_set>
 #if _MSC_VER < 1310 || _MSC_VER >= 1600
-using std::hash_map;
+// using std::hash_map;
+#include <unordered_map>
+#define hash_map unordered_map
 #else
 using stdext::hash_map;
 #endif
@@ -171,4 +173,24 @@ struct hash<uint64> {
 }
 #endif
 #endif
+
+#include <string>
+#ifdef _WIN32
+#include <windows.h>
+inline std::wstring Utf8ToWideWin(const char *input) {
+  if (!input)
+    return std::wstring();
+  int len = MultiByteToWideChar(CP_UTF8, 0, input, -1, NULL, 0);
+  if (len <= 0)
+    return std::wstring();
+  std::wstring w(len, L'\0');
+  MultiByteToWideChar(CP_UTF8, 0, input, -1, &w[0], len);
+  if (!w.empty() && w.back() == L'\0')
+    w.pop_back();
+  return w;
+}
+#undef WPATH
+#define WPATH(path) (Utf8ToWideWin(path).c_str())
+#endif
+
 #endif
